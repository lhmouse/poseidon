// This file is part of Poseidon.
// Copyright (C) 2022-2025, LH_Mouse. All wrongs reserved.

#include "xprecompiled.hpp"
#include "geometry.hpp"
namespace poseidon {
namespace {

alignas(16) constexpr trigonometric s_trig_table[360] =
  {
    {  0.0000000000F,  1.0000000000F,  0.000000000F,  0 },  //   0
    {  0.0174524064F,  0.9998476952F,  0.017455065F,  0 },  //   1
    {  0.0348994967F,  0.9993908270F,  0.034920769F,  0 },  //   2
    {  0.0523359562F,  0.9986295348F,  0.052407779F,  0 },  //   3
    {  0.0697564737F,  0.9975640503F,  0.069926812F,  0 },  //   4
    {  0.0871557427F,  0.9961946981F,  0.087488664F,  0 },  //   5
    {  0.1045284633F,  0.9945218954F,  0.105104235F,  0 },  //   6
    {  0.1218693434F,  0.9925461516F,  0.122784561F,  0 },  //   7
    {  0.1391731010F,  0.9902680687F,  0.140540835F,  0 },  //   8
    {  0.1564344650F,  0.9876883406F,  0.158384440F,  0 },  //   9
    {  0.1736481777F,  0.9848077530F,  0.176326981F,  0 },  //  10
    {  0.1908089954F,  0.9816271834F,  0.194380309F,  0 },  //  11
    {  0.2079116908F,  0.9781476007F,  0.212556562F,  0 },  //  12
    {  0.2249510543F,  0.9743700648F,  0.230868191F,  0 },  //  13
    {  0.2419218956F,  0.9702957263F,  0.249328003F,  0 },  //  14
    {  0.2588190451F,  0.9659258263F,  0.267949192F,  0 },  //  15
    {  0.2756373558F,  0.9612616959F,  0.286745386F,  0 },  //  16
    {  0.2923717047F,  0.9563047560F,  0.305730681F,  0 },  //  17
    {  0.3090169944F,  0.9510565163F,  0.324919696F,  0 },  //  18
    {  0.3255681545F,  0.9455185756F,  0.344327613F,  0 },  //  19
    {  0.3420201433F,  0.9396926208F,  0.363970234F,  0 },  //  20
    {  0.3583679495F,  0.9335804265F,  0.383864035F,  0 },  //  21
    {  0.3746065934F,  0.9271838546F,  0.404026226F,  0 },  //  22
    {  0.3907311285F,  0.9205048535F,  0.424474816F,  0 },  //  23
    {  0.4067366431F,  0.9135454576F,  0.445228685F,  0 },  //  24
    {  0.4226182617F,  0.9063077870F,  0.466307658F,  0 },  //  25
    {  0.4383711468F,  0.8987940463F,  0.487732589F,  0 },  //  26
    {  0.4539904997F,  0.8910065242F,  0.509525449F,  0 },  //  27
    {  0.4694715628F,  0.8829475929F,  0.531709432F,  0 },  //  28
    {  0.4848096202F,  0.8746197071F,  0.554309051F,  0 },  //  29
    {  0.5000000000F,  0.8660254038F,  0.577350269F,  0 },  //  30
    {  0.5150380749F,  0.8571673007F,  0.600860619F,  0 },  //  31
    {  0.5299192642F,  0.8480480962F,  0.624869352F,  0 },  //  32
    {  0.5446390350F,  0.8386705679F,  0.649407593F,  0 },  //  33
    {  0.5591929035F,  0.8290375726F,  0.674508517F,  0 },  //  34
    {  0.5735764364F,  0.8191520443F,  0.700207538F,  0 },  //  35
    {  0.5877852523F,  0.8090169944F,  0.726542528F,  0 },  //  36
    {  0.6018150232F,  0.7986355100F,  0.753554050F,  0 },  //  37
    {  0.6156614753F,  0.7880107536F,  0.781285627F,  0 },  //  38
    {  0.6293203910F,  0.7771459615F,  0.809784033F,  0 },  //  39
    {  0.6427876097F,  0.7660444431F,  0.839099631F,  0 },  //  40
    {  0.6560590290F,  0.7547095802F,  0.869286738F,  0 },  //  41
    {  0.6691306064F,  0.7431448255F,  0.900404044F,  0 },  //  42
    {  0.6819983601F,  0.7313537016F,  0.932515086F,  0 },  //  43
    {  0.6946583705F,  0.7193398003F,  0.965688775F,  0 },  //  44
    {  0.7071067812F,  0.7071067812F,  1.000000000F,  0 },  //  45
    {  0.7193398003F,  0.6946583705F,  1.035530314F,  0 },  //  46
    {  0.7313537016F,  0.6819983601F,  1.072368710F,  0 },  //  47
    {  0.7431448255F,  0.6691306064F,  1.110612515F,  0 },  //  48
    {  0.7547095802F,  0.6560590290F,  1.150368407F,  0 },  //  49
    {  0.7660444431F,  0.6427876097F,  1.191753593F,  0 },  //  50
    {  0.7771459615F,  0.6293203910F,  1.234897157F,  0 },  //  51
    {  0.7880107536F,  0.6156614753F,  1.279941632F,  0 },  //  52
    {  0.7986355100F,  0.6018150232F,  1.327044822F,  0 },  //  53
    {  0.8090169944F,  0.5877852523F,  1.376381920F,  0 },  //  54
    {  0.8191520443F,  0.5735764364F,  1.428148007F,  0 },  //  55
    {  0.8290375726F,  0.5591929035F,  1.482560969F,  0 },  //  56
    {  0.8386705679F,  0.5446390350F,  1.539864964F,  0 },  //  57
    {  0.8480480962F,  0.5299192642F,  1.600334529F,  0 },  //  58
    {  0.8571673007F,  0.5150380749F,  1.664279482F,  0 },  //  59
    {  0.8660254038F,  0.5000000000F,  1.732050808F,  0 },  //  60
    {  0.8746197071F,  0.4848096202F,  1.804047755F,  0 },  //  61
    {  0.8829475929F,  0.4694715628F,  1.880726465F,  0 },  //  62
    {  0.8910065242F,  0.4539904997F,  1.962610506F,  0 },  //  63
    {  0.8987940463F,  0.4383711468F,  2.050303842F,  0 },  //  64
    {  0.9063077870F,  0.4226182617F,  2.144506921F,  0 },  //  65
    {  0.9135454576F,  0.4067366431F,  2.246036774F,  0 },  //  66
    {  0.9205048535F,  0.3907311285F,  2.355852366F,  0 },  //  67
    {  0.9271838546F,  0.3746065934F,  2.475086853F,  0 },  //  68
    {  0.9335804265F,  0.3583679495F,  2.605089065F,  0 },  //  69
    {  0.9396926208F,  0.3420201433F,  2.747477419F,  0 },  //  70
    {  0.9455185756F,  0.3255681545F,  2.904210878F,  0 },  //  71
    {  0.9510565163F,  0.3090169944F,  3.077683537F,  0 },  //  72
    {  0.9563047560F,  0.2923717047F,  3.270852618F,  0 },  //  73
    {  0.9612616959F,  0.2756373558F,  3.487414444F,  0 },  //  74
    {  0.9659258263F,  0.2588190451F,  3.732050808F,  0 },  //  75
    {  0.9702957263F,  0.2419218956F,  4.010780934F,  0 },  //  76
    {  0.9743700648F,  0.2249510543F,  4.331475874F,  0 },  //  77
    {  0.9781476007F,  0.2079116908F,  4.704630109F,  0 },  //  78
    {  0.9816271834F,  0.1908089954F,  5.144554016F,  0 },  //  79
    {  0.9848077530F,  0.1736481777F,  5.671281820F,  0 },  //  80
    {  0.9876883406F,  0.1564344650F,  6.313751515F,  0 },  //  81
    {  0.9902680687F,  0.1391731010F,  7.115369722F,  0 },  //  82
    {  0.9925461516F,  0.1218693434F,  8.144346428F,  0 },  //  83
    {  0.9945218954F,  0.1045284633F,  9.514364454F,  0 },  //  84
    {  0.9961946981F,  0.0871557427F,  11.43005230F,  0 },  //  85
    {  0.9975640503F,  0.0697564737F,  14.30066626F,  0 },  //  86
    {  0.9986295348F,  0.0523359562F,  19.08113669F,  0 },  //  87
    {  0.9993908270F,  0.0348994967F,  28.63625328F,  0 },  //  88
    {  0.9998476952F,  0.0174524064F,  57.28996163F,  0 },  //  89
    {  1.0000000000F,  0.0000000000F,     HUGE_VALF,  0 },  //  90
    {  0.9998476952F, -0.0174524064F, -57.28996163F,  0 },  //  91
    {  0.9993908270F, -0.0348994967F, -28.63625328F,  0 },  //  92
    {  0.9986295348F, -0.0523359562F, -19.08113669F,  0 },  //  93
    {  0.9975640503F, -0.0697564737F, -14.30066626F,  0 },  //  94
    {  0.9961946981F, -0.0871557427F, -11.43005230F,  0 },  //  95
    {  0.9945218954F, -0.1045284633F, -9.514364454F,  0 },  //  96
    {  0.9925461516F, -0.1218693434F, -8.144346428F,  0 },  //  97
    {  0.9902680687F, -0.1391731010F, -7.115369722F,  0 },  //  98
    {  0.9876883406F, -0.1564344650F, -6.313751515F,  0 },  //  99
    {  0.9848077530F, -0.1736481777F, -5.671281820F,  0 },  // 100
    {  0.9816271834F, -0.1908089954F, -5.144554016F,  0 },  // 101
    {  0.9781476007F, -0.2079116908F, -4.704630109F,  0 },  // 102
    {  0.9743700648F, -0.2249510543F, -4.331475874F,  0 },  // 103
    {  0.9702957263F, -0.2419218956F, -4.010780934F,  0 },  // 104
    {  0.9659258263F, -0.2588190451F, -3.732050808F,  0 },  // 105
    {  0.9612616959F, -0.2756373558F, -3.487414444F,  0 },  // 106
    {  0.9563047560F, -0.2923717047F, -3.270852618F,  0 },  // 107
    {  0.9510565163F, -0.3090169944F, -3.077683537F,  0 },  // 108
    {  0.9455185756F, -0.3255681545F, -2.904210878F,  0 },  // 109
    {  0.9396926208F, -0.3420201433F, -2.747477419F,  0 },  // 110
    {  0.9335804265F, -0.3583679495F, -2.605089065F,  0 },  // 111
    {  0.9271838546F, -0.3746065934F, -2.475086853F,  0 },  // 112
    {  0.9205048535F, -0.3907311285F, -2.355852366F,  0 },  // 113
    {  0.9135454576F, -0.4067366431F, -2.246036774F,  0 },  // 114
    {  0.9063077870F, -0.4226182617F, -2.144506921F,  0 },  // 115
    {  0.8987940463F, -0.4383711468F, -2.050303842F,  0 },  // 116
    {  0.8910065242F, -0.4539904997F, -1.962610506F,  0 },  // 117
    {  0.8829475929F, -0.4694715628F, -1.880726465F,  0 },  // 118
    {  0.8746197071F, -0.4848096202F, -1.804047755F,  0 },  // 119
    {  0.8660254038F, -0.5000000000F, -1.732050808F,  0 },  // 120
    {  0.8571673007F, -0.5150380749F, -1.664279482F,  0 },  // 121
    {  0.8480480962F, -0.5299192642F, -1.600334529F,  0 },  // 122
    {  0.8386705679F, -0.5446390350F, -1.539864964F,  0 },  // 123
    {  0.8290375726F, -0.5591929035F, -1.482560969F,  0 },  // 124
    {  0.8191520443F, -0.5735764364F, -1.428148007F,  0 },  // 125
    {  0.8090169944F, -0.5877852523F, -1.376381920F,  0 },  // 126
    {  0.7986355100F, -0.6018150232F, -1.327044822F,  0 },  // 127
    {  0.7880107536F, -0.6156614753F, -1.279941632F,  0 },  // 128
    {  0.7771459615F, -0.6293203910F, -1.234897157F,  0 },  // 129
    {  0.7660444431F, -0.6427876097F, -1.191753593F,  0 },  // 130
    {  0.7547095802F, -0.6560590290F, -1.150368407F,  0 },  // 131
    {  0.7431448255F, -0.6691306064F, -1.110612515F,  0 },  // 132
    {  0.7313537016F, -0.6819983601F, -1.072368710F,  0 },  // 133
    {  0.7193398003F, -0.6946583705F, -1.035530314F,  0 },  // 134
    {  0.7071067812F, -0.7071067812F, -1.000000000F,  0 },  // 135
    {  0.6946583705F, -0.7193398003F, -0.965688775F,  0 },  // 136
    {  0.6819983601F, -0.7313537016F, -0.932515086F,  0 },  // 137
    {  0.6691306064F, -0.7431448255F, -0.900404044F,  0 },  // 138
    {  0.6560590290F, -0.7547095802F, -0.869286738F,  0 },  // 139
    {  0.6427876097F, -0.7660444431F, -0.839099631F,  0 },  // 140
    {  0.6293203910F, -0.7771459615F, -0.809784033F,  0 },  // 141
    {  0.6156614753F, -0.7880107536F, -0.781285627F,  0 },  // 142
    {  0.6018150232F, -0.7986355100F, -0.753554050F,  0 },  // 143
    {  0.5877852523F, -0.8090169944F, -0.726542528F,  0 },  // 144
    {  0.5735764364F, -0.8191520443F, -0.700207538F,  0 },  // 145
    {  0.5591929035F, -0.8290375726F, -0.674508517F,  0 },  // 146
    {  0.5446390350F, -0.8386705679F, -0.649407593F,  0 },  // 147
    {  0.5299192642F, -0.8480480962F, -0.624869352F,  0 },  // 148
    {  0.5150380749F, -0.8571673007F, -0.600860619F,  0 },  // 149
    {  0.5000000000F, -0.8660254038F, -0.577350269F,  0 },  // 150
    {  0.4848096202F, -0.8746197071F, -0.554309051F,  0 },  // 151
    {  0.4694715628F, -0.8829475929F, -0.531709432F,  0 },  // 152
    {  0.4539904997F, -0.8910065242F, -0.509525449F,  0 },  // 153
    {  0.4383711468F, -0.8987940463F, -0.487732589F,  0 },  // 154
    {  0.4226182617F, -0.9063077870F, -0.466307658F,  0 },  // 155
    {  0.4067366431F, -0.9135454576F, -0.445228685F,  0 },  // 156
    {  0.3907311285F, -0.9205048535F, -0.424474816F,  0 },  // 157
    {  0.3746065934F, -0.9271838546F, -0.404026226F,  0 },  // 158
    {  0.3583679495F, -0.9335804265F, -0.383864035F,  0 },  // 159
    {  0.3420201433F, -0.9396926208F, -0.363970234F,  0 },  // 160
    {  0.3255681545F, -0.9455185756F, -0.344327613F,  0 },  // 161
    {  0.3090169944F, -0.9510565163F, -0.324919696F,  0 },  // 162
    {  0.2923717047F, -0.9563047560F, -0.305730681F,  0 },  // 163
    {  0.2756373558F, -0.9612616959F, -0.286745386F,  0 },  // 164
    {  0.2588190451F, -0.9659258263F, -0.267949192F,  0 },  // 165
    {  0.2419218956F, -0.9702957263F, -0.249328003F,  0 },  // 166
    {  0.2249510543F, -0.9743700648F, -0.230868191F,  0 },  // 167
    {  0.2079116908F, -0.9781476007F, -0.212556562F,  0 },  // 168
    {  0.1908089954F, -0.9816271834F, -0.194380309F,  0 },  // 169
    {  0.1736481777F, -0.9848077530F, -0.176326981F,  0 },  // 170
    {  0.1564344650F, -0.9876883406F, -0.158384440F,  0 },  // 171
    {  0.1391731010F, -0.9902680687F, -0.140540835F,  0 },  // 172
    {  0.1218693434F, -0.9925461516F, -0.122784561F,  0 },  // 173
    {  0.1045284633F, -0.9945218954F, -0.105104235F,  0 },  // 174
    {  0.0871557427F, -0.9961946981F, -0.087488664F,  0 },  // 175
    {  0.0697564737F, -0.9975640503F, -0.069926812F,  0 },  // 176
    {  0.0523359562F, -0.9986295348F, -0.052407779F,  0 },  // 177
    {  0.0348994967F, -0.9993908270F, -0.034920769F,  0 },  // 178
    {  0.0174524064F, -0.9998476952F, -0.017455065F,  0 },  // 179
    {  0.0000000000F, -1.0000000000F, -0.000000000F,  0 },  // 180
    { -0.0174524064F, -0.9998476952F,  0.017455065F,  0 },  // 181
    { -0.0348994967F, -0.9993908270F,  0.034920769F,  0 },  // 182
    { -0.0523359562F, -0.9986295348F,  0.052407779F,  0 },  // 183
    { -0.0697564737F, -0.9975640503F,  0.069926812F,  0 },  // 184
    { -0.0871557427F, -0.9961946981F,  0.087488664F,  0 },  // 185
    { -0.1045284633F, -0.9945218954F,  0.105104235F,  0 },  // 186
    { -0.1218693434F, -0.9925461516F,  0.122784561F,  0 },  // 187
    { -0.1391731010F, -0.9902680687F,  0.140540835F,  0 },  // 188
    { -0.1564344650F, -0.9876883406F,  0.158384440F,  0 },  // 189
    { -0.1736481777F, -0.9848077530F,  0.176326981F,  0 },  // 190
    { -0.1908089954F, -0.9816271834F,  0.194380309F,  0 },  // 191
    { -0.2079116908F, -0.9781476007F,  0.212556562F,  0 },  // 192
    { -0.2249510543F, -0.9743700648F,  0.230868191F,  0 },  // 193
    { -0.2419218956F, -0.9702957263F,  0.249328003F,  0 },  // 194
    { -0.2588190451F, -0.9659258263F,  0.267949192F,  0 },  // 195
    { -0.2756373558F, -0.9612616959F,  0.286745386F,  0 },  // 196
    { -0.2923717047F, -0.9563047560F,  0.305730681F,  0 },  // 197
    { -0.3090169944F, -0.9510565163F,  0.324919696F,  0 },  // 198
    { -0.3255681545F, -0.9455185756F,  0.344327613F,  0 },  // 199
    { -0.3420201433F, -0.9396926208F,  0.363970234F,  0 },  // 200
    { -0.3583679495F, -0.9335804265F,  0.383864035F,  0 },  // 201
    { -0.3746065934F, -0.9271838546F,  0.404026226F,  0 },  // 202
    { -0.3907311285F, -0.9205048535F,  0.424474816F,  0 },  // 203
    { -0.4067366431F, -0.9135454576F,  0.445228685F,  0 },  // 204
    { -0.4226182617F, -0.9063077870F,  0.466307658F,  0 },  // 205
    { -0.4383711468F, -0.8987940463F,  0.487732589F,  0 },  // 206
    { -0.4539904997F, -0.8910065242F,  0.509525449F,  0 },  // 207
    { -0.4694715628F, -0.8829475929F,  0.531709432F,  0 },  // 208
    { -0.4848096202F, -0.8746197071F,  0.554309051F,  0 },  // 209
    { -0.5000000000F, -0.8660254038F,  0.577350269F,  0 },  // 210
    { -0.5150380749F, -0.8571673007F,  0.600860619F,  0 },  // 211
    { -0.5299192642F, -0.8480480962F,  0.624869352F,  0 },  // 212
    { -0.5446390350F, -0.8386705679F,  0.649407593F,  0 },  // 213
    { -0.5591929035F, -0.8290375726F,  0.674508517F,  0 },  // 214
    { -0.5735764364F, -0.8191520443F,  0.700207538F,  0 },  // 215
    { -0.5877852523F, -0.8090169944F,  0.726542528F,  0 },  // 216
    { -0.6018150232F, -0.7986355100F,  0.753554050F,  0 },  // 217
    { -0.6156614753F, -0.7880107536F,  0.781285627F,  0 },  // 218
    { -0.6293203910F, -0.7771459615F,  0.809784033F,  0 },  // 219
    { -0.6427876097F, -0.7660444431F,  0.839099631F,  0 },  // 220
    { -0.6560590290F, -0.7547095802F,  0.869286738F,  0 },  // 221
    { -0.6691306064F, -0.7431448255F,  0.900404044F,  0 },  // 222
    { -0.6819983601F, -0.7313537016F,  0.932515086F,  0 },  // 223
    { -0.6946583705F, -0.7193398003F,  0.965688775F,  0 },  // 224
    { -0.7071067812F, -0.7071067812F,  1.000000000F,  0 },  // 225
    { -0.7193398003F, -0.6946583705F,  1.035530314F,  0 },  // 226
    { -0.7313537016F, -0.6819983601F,  1.072368710F,  0 },  // 227
    { -0.7431448255F, -0.6691306064F,  1.110612515F,  0 },  // 228
    { -0.7547095802F, -0.6560590290F,  1.150368407F,  0 },  // 229
    { -0.7660444431F, -0.6427876097F,  1.191753593F,  0 },  // 230
    { -0.7771459615F, -0.6293203910F,  1.234897157F,  0 },  // 231
    { -0.7880107536F, -0.6156614753F,  1.279941632F,  0 },  // 232
    { -0.7986355100F, -0.6018150232F,  1.327044822F,  0 },  // 233
    { -0.8090169944F, -0.5877852523F,  1.376381920F,  0 },  // 234
    { -0.8191520443F, -0.5735764364F,  1.428148007F,  0 },  // 235
    { -0.8290375726F, -0.5591929035F,  1.482560969F,  0 },  // 236
    { -0.8386705679F, -0.5446390350F,  1.539864964F,  0 },  // 237
    { -0.8480480962F, -0.5299192642F,  1.600334529F,  0 },  // 238
    { -0.8571673007F, -0.5150380749F,  1.664279482F,  0 },  // 239
    { -0.8660254038F, -0.5000000000F,  1.732050808F,  0 },  // 240
    { -0.8746197071F, -0.4848096202F,  1.804047755F,  0 },  // 241
    { -0.8829475929F, -0.4694715628F,  1.880726465F,  0 },  // 242
    { -0.8910065242F, -0.4539904997F,  1.962610506F,  0 },  // 243
    { -0.8987940463F, -0.4383711468F,  2.050303842F,  0 },  // 244
    { -0.9063077870F, -0.4226182617F,  2.144506921F,  0 },  // 245
    { -0.9135454576F, -0.4067366431F,  2.246036774F,  0 },  // 246
    { -0.9205048535F, -0.3907311285F,  2.355852366F,  0 },  // 247
    { -0.9271838546F, -0.3746065934F,  2.475086853F,  0 },  // 248
    { -0.9335804265F, -0.3583679495F,  2.605089065F,  0 },  // 249
    { -0.9396926208F, -0.3420201433F,  2.747477419F,  0 },  // 250
    { -0.9455185756F, -0.3255681545F,  2.904210878F,  0 },  // 251
    { -0.9510565163F, -0.3090169944F,  3.077683537F,  0 },  // 252
    { -0.9563047560F, -0.2923717047F,  3.270852618F,  0 },  // 253
    { -0.9612616959F, -0.2756373558F,  3.487414444F,  0 },  // 254
    { -0.9659258263F, -0.2588190451F,  3.732050808F,  0 },  // 255
    { -0.9702957263F, -0.2419218956F,  4.010780934F,  0 },  // 256
    { -0.9743700648F, -0.2249510543F,  4.331475874F,  0 },  // 257
    { -0.9781476007F, -0.2079116908F,  4.704630109F,  0 },  // 258
    { -0.9816271834F, -0.1908089954F,  5.144554016F,  0 },  // 259
    { -0.9848077530F, -0.1736481777F,  5.671281820F,  0 },  // 260
    { -0.9876883406F, -0.1564344650F,  6.313751515F,  0 },  // 261
    { -0.9902680687F, -0.1391731010F,  7.115369722F,  0 },  // 262
    { -0.9925461516F, -0.1218693434F,  8.144346428F,  0 },  // 263
    { -0.9945218954F, -0.1045284633F,  9.514364454F,  0 },  // 264
    { -0.9961946981F, -0.0871557427F,  11.43005230F,  0 },  // 265
    { -0.9975640503F, -0.0697564737F,  14.30066626F,  0 },  // 266
    { -0.9986295348F, -0.0523359562F,  19.08113669F,  0 },  // 267
    { -0.9993908270F, -0.0348994967F,  28.63625328F,  0 },  // 268
    { -0.9998476952F, -0.0174524064F,  57.28996163F,  0 },  // 269
    { -1.0000000000F, -0.0000000000F,     HUGE_VALF,  0 },  // 270
    { -0.9998476952F,  0.0174524064F, -57.28996163F,  0 },  // 271
    { -0.9993908270F,  0.0348994967F, -28.63625328F,  0 },  // 272
    { -0.9986295348F,  0.0523359562F, -19.08113669F,  0 },  // 273
    { -0.9975640503F,  0.0697564737F, -14.30066626F,  0 },  // 274
    { -0.9961946981F,  0.0871557427F, -11.43005230F,  0 },  // 275
    { -0.9945218954F,  0.1045284633F, -9.514364454F,  0 },  // 276
    { -0.9925461516F,  0.1218693434F, -8.144346428F,  0 },  // 277
    { -0.9902680687F,  0.1391731010F, -7.115369722F,  0 },  // 278
    { -0.9876883406F,  0.1564344650F, -6.313751515F,  0 },  // 279
    { -0.9848077530F,  0.1736481777F, -5.671281820F,  0 },  // 280
    { -0.9816271834F,  0.1908089954F, -5.144554016F,  0 },  // 281
    { -0.9781476007F,  0.2079116908F, -4.704630109F,  0 },  // 282
    { -0.9743700648F,  0.2249510543F, -4.331475874F,  0 },  // 283
    { -0.9702957263F,  0.2419218956F, -4.010780934F,  0 },  // 284
    { -0.9659258263F,  0.2588190451F, -3.732050808F,  0 },  // 285
    { -0.9612616959F,  0.2756373558F, -3.487414444F,  0 },  // 286
    { -0.9563047560F,  0.2923717047F, -3.270852618F,  0 },  // 287
    { -0.9510565163F,  0.3090169944F, -3.077683537F,  0 },  // 288
    { -0.9455185756F,  0.3255681545F, -2.904210878F,  0 },  // 289
    { -0.9396926208F,  0.3420201433F, -2.747477419F,  0 },  // 290
    { -0.9335804265F,  0.3583679495F, -2.605089065F,  0 },  // 291
    { -0.9271838546F,  0.3746065934F, -2.475086853F,  0 },  // 292
    { -0.9205048535F,  0.3907311285F, -2.355852366F,  0 },  // 293
    { -0.9135454576F,  0.4067366431F, -2.246036774F,  0 },  // 294
    { -0.9063077870F,  0.4226182617F, -2.144506921F,  0 },  // 295
    { -0.8987940463F,  0.4383711468F, -2.050303842F,  0 },  // 296
    { -0.8910065242F,  0.4539904997F, -1.962610506F,  0 },  // 297
    { -0.8829475929F,  0.4694715628F, -1.880726465F,  0 },  // 298
    { -0.8746197071F,  0.4848096202F, -1.804047755F,  0 },  // 299
    { -0.8660254038F,  0.5000000000F, -1.732050808F,  0 },  // 300
    { -0.8571673007F,  0.5150380749F, -1.664279482F,  0 },  // 301
    { -0.8480480962F,  0.5299192642F, -1.600334529F,  0 },  // 302
    { -0.8386705679F,  0.5446390350F, -1.539864964F,  0 },  // 303
    { -0.8290375726F,  0.5591929035F, -1.482560969F,  0 },  // 304
    { -0.8191520443F,  0.5735764364F, -1.428148007F,  0 },  // 305
    { -0.8090169944F,  0.5877852523F, -1.376381920F,  0 },  // 306
    { -0.7986355100F,  0.6018150232F, -1.327044822F,  0 },  // 307
    { -0.7880107536F,  0.6156614753F, -1.279941632F,  0 },  // 308
    { -0.7771459615F,  0.6293203910F, -1.234897157F,  0 },  // 309
    { -0.7660444431F,  0.6427876097F, -1.191753593F,  0 },  // 310
    { -0.7547095802F,  0.6560590290F, -1.150368407F,  0 },  // 311
    { -0.7431448255F,  0.6691306064F, -1.110612515F,  0 },  // 312
    { -0.7313537016F,  0.6819983601F, -1.072368710F,  0 },  // 313
    { -0.7193398003F,  0.6946583705F, -1.035530314F,  0 },  // 314
    { -0.7071067812F,  0.7071067812F, -1.000000000F,  0 },  // 315
    { -0.6946583705F,  0.7193398003F, -0.965688775F,  0 },  // 316
    { -0.6819983601F,  0.7313537016F, -0.932515086F,  0 },  // 317
    { -0.6691306064F,  0.7431448255F, -0.900404044F,  0 },  // 318
    { -0.6560590290F,  0.7547095802F, -0.869286738F,  0 },  // 319
    { -0.6427876097F,  0.7660444431F, -0.839099631F,  0 },  // 320
    { -0.6293203910F,  0.7771459615F, -0.809784033F,  0 },  // 321
    { -0.6156614753F,  0.7880107536F, -0.781285627F,  0 },  // 322
    { -0.6018150232F,  0.7986355100F, -0.753554050F,  0 },  // 323
    { -0.5877852523F,  0.8090169944F, -0.726542528F,  0 },  // 324
    { -0.5735764364F,  0.8191520443F, -0.700207538F,  0 },  // 325
    { -0.5591929035F,  0.8290375726F, -0.674508517F,  0 },  // 326
    { -0.5446390350F,  0.8386705679F, -0.649407593F,  0 },  // 327
    { -0.5299192642F,  0.8480480962F, -0.624869352F,  0 },  // 328
    { -0.5150380749F,  0.8571673007F, -0.600860619F,  0 },  // 329
    { -0.5000000000F,  0.8660254038F, -0.577350269F,  0 },  // 330
    { -0.4848096202F,  0.8746197071F, -0.554309051F,  0 },  // 331
    { -0.4694715628F,  0.8829475929F, -0.531709432F,  0 },  // 332
    { -0.4539904997F,  0.8910065242F, -0.509525449F,  0 },  // 333
    { -0.4383711468F,  0.8987940463F, -0.487732589F,  0 },  // 334
    { -0.4226182617F,  0.9063077870F, -0.466307658F,  0 },  // 335
    { -0.4067366431F,  0.9135454576F, -0.445228685F,  0 },  // 336
    { -0.3907311285F,  0.9205048535F, -0.424474816F,  0 },  // 337
    { -0.3746065934F,  0.9271838546F, -0.404026226F,  0 },  // 338
    { -0.3583679495F,  0.9335804265F, -0.383864035F,  0 },  // 339
    { -0.3420201433F,  0.9396926208F, -0.363970234F,  0 },  // 340
    { -0.3255681545F,  0.9455185756F, -0.344327613F,  0 },  // 341
    { -0.3090169944F,  0.9510565163F, -0.324919696F,  0 },  // 342
    { -0.2923717047F,  0.9563047560F, -0.305730681F,  0 },  // 343
    { -0.2756373558F,  0.9612616959F, -0.286745386F,  0 },  // 344
    { -0.2588190451F,  0.9659258263F, -0.267949192F,  0 },  // 345
    { -0.2419218956F,  0.9702957263F, -0.249328003F,  0 },  // 346
    { -0.2249510543F,  0.9743700648F, -0.230868191F,  0 },  // 347
    { -0.2079116908F,  0.9781476007F, -0.212556562F,  0 },  // 348
    { -0.1908089954F,  0.9816271834F, -0.194380309F,  0 },  // 349
    { -0.1736481777F,  0.9848077530F, -0.176326981F,  0 },  // 350
    { -0.1564344650F,  0.9876883406F, -0.158384440F,  0 },  // 351
    { -0.1391731010F,  0.9902680687F, -0.140540835F,  0 },  // 352
    { -0.1218693434F,  0.9925461516F, -0.122784561F,  0 },  // 353
    { -0.1045284633F,  0.9945218954F, -0.105104235F,  0 },  // 354
    { -0.0871557427F,  0.9961946981F, -0.087488664F,  0 },  // 355
    { -0.0697564737F,  0.9975640503F, -0.069926812F,  0 },  // 356
    { -0.0523359562F,  0.9986295348F, -0.052407779F,  0 },  // 357
    { -0.0348994967F,  0.9993908270F, -0.034920769F,  0 },  // 358
    { -0.0174524064F,  0.9998476952F, -0.017455065F,  0 },  // 359
  };

int
do_reduced_arctan(float slope)
  {
    // Binary-search for the closest `theta` where `tan(theta) > slope`. As
    // the tangent function is monotonic, the closest angle must be either
    // `theta` or `theta - 1`. In order to prevent out-of-bound access, we
    // search from 1 rather than 0.
    ROCKET_ASSERT((slope >= 0) && (slope <= 1));
    uint32_t lower = 1;
    uint32_t theta = 45;

    while(lower != theta) {
      uint32_t mid = (lower + theta) / 2;
      if(slope < s_trig_table[mid].tan)
        theta = mid;
      else
        lower = mid + 1;
    }

    lower --;
    ROCKET_ASSERT((s_trig_table[theta].tan > slope) || (slope == 1));
    ROCKET_ASSERT(s_trig_table[lower].tan <= slope);

    return (s_trig_table[theta].tan - slope < slope - s_trig_table[lower].tan)
           ? static_cast<int>(theta)
           : static_cast<int>(lower);
  }

}  // namespace

trigonometric
do_trig_degrees(int theta)
  noexcept
  {
    uint32_t t = (static_cast<uint32_t>(theta) + 2147483520) % 360;
    return s_trig_table[t];
  }

int
do_arctan_degrees(float y, float x)
  noexcept
  {
    if((y == 0) || (y != y))
      return signbit(x) ? 180 : 0;
    else if((x == 0) || (x != x))
      return signbit(y) ? 270 : 90;

    // Determine the octant of this angle, clockwise.
    __m128 ps = _mm_cmpgt_ps(_mm_set_ps(x, x, y, y), _mm_set_ps(0, -y, 0, x));
    switch(_mm_movemask_ps(ps))
      {
      case 0b1110:  // x > y > 0 > -x
        return do_reduced_arctan(y / x);

      case 0b1111:  // y > x > 0 > -x
        return 90 - do_reduced_arctan(x / y);

      case 0b0111:  // y > -x > 0 > x
        return 90 + do_reduced_arctan(x / -y);

      case 0b0011:  // -x > y > 0 > x
        return 180 - do_reduced_arctan(-y / x);

      case 0b0001:  // -x > 0 > y > x
        return 180 + do_reduced_arctan(y / x);

      case 0b0000:  // -x > 0 > x > y
        return 270 - do_reduced_arctan(x / y);

      case 0b1000:  // x > 0 > -x > y
        return 270 + do_reduced_arctan(x / -y);

      case 0b1100:  // x > 0 > y > -x
        return 360 - do_reduced_arctan(-y / x);

      default:
        ROCKET_UNREACHABLE();
      }
  }

}  // namespace poseidon
