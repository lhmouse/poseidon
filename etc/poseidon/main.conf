// This is a test file for starting the server from its source directory.
// This file will never get installed.

general: {
  // permit_root_startup:
  //   true           = the program may start as root (DISCOURAGED)
  //   null or false  = the program cannot start as root
  permit_root_startup: true

  // pid_file_path:
  //   [path]      = write PID to this file after startup
  //   null        = don't write PID anywhere
  pid_file_path: "../../var/poseidon/poseidon.pid"

  // default_compression_level:
  //   0        = disable compression
  //   1-9      = specify level of compression
  //   null     = use zlib default value
  default_compression_level: 8
}

logger: {
  // These are settings for the global logger.
  // Six levels are defined here, each of which is assigned a hard-coded
  // name. They correspond to `POSEIDON_LOG_*` macros.
  colors: {
    // These are ANSI code sequences for each level. If monochrome output
    // is desired, these can be null.
    // Reference: https://en.wikipedia.org/wiki/ANSI_escape_code#SGR
    fatal: "35;1"
    error: "31;1"
    warn: "33"
    info: "32"
    debug: "36"
    trace: "34;1"
  }

  files: {
    // These are collective output files for all levels.
    server_err: "../../var/poseidon/server.err"
    server_log: "../../var/poseidon/server.log"
  }

  // These are settings for all levels. Unless otherwise specified, each
  // name in these arrays shall denote a name in `files`. If `"STDERR"` or
  // `"STDOUT"` is specified, messages are copied to the standard error or
  // output stream, respectively. If `"TRIVIAL"` is specified, messages may
  // be discarded in case of congestion.
  fatal: [ "server_err" "STDERR" ]
  error: [ "server_err" "STDERR" ]
  warn:  [ "server_log" "STDOUT" ]
  info:  [ "server_log" "STDOUT" ]
  debug: [ "server_log" "STDOUT" "TRIVIAL" ]
  trace: [ ]
}

network: {
  // These are settings for the network driver.
  poll: {
    // event_buffer_size:
    //   [count]  = number of I/O events for each single poll
    //   null     = default value: 1 KiB
    event_buffer_size: 1024

    // throttle_size:
    //   [bytes]  = suspend reading if write queue exceeds this size
    //   null     = default value: 1 MiB
    throttle_size: 1048576
  }

  // These are settings for SSL/TLS connections.
  ssl: {
    // default_certificate:
    //   [path]  = default certificate file for servers
    //   null    = no default certificate
    default_certificate: "ssl/test.crt"

    // default_private_key:
    //   [path]  = default private key file for servers
    //   null    = no default private key
    default_private_key: "ssl/test.key"

    // trusted_ca_path:
    //   [path]  = directory of trusted CA certificates for clients
    //   null    = no validation (DANGEROUS for production use)
    trusted_ca_path: "/etc/ssl/certs"
  }

  // These are settings for HTTP and WebSocket connections.
  http: {
    // max_request_content_length:
    //   [bytes]  = maximum number of bytes that the body of a request
    //              message from a client is allowed to contain (used by
    //              the default implementation of `HTTP_Server_Session::
    //              do_on_http_request_payload_stream()`)
    //   null     = default value: 3 MiB
    max_request_content_length: 3145728

    // max_response_content_length:
    //   [bytes]  = maximum number of bytes that the body of a response
    //              message from another server may contain (used by the
    //              default implementation of `HTTP_Client_Session::
    //              do_on_http_response_payload_stream()`)
    //   null     = default value: 1 MiB
    max_response_content_length: 1048576

    // keep_alive_timeout:
    //   [secs]   = shut persistent connections down after this timeout
    //   null     = default value: 30
    keep_alive_timeout: 30

    // max_websocket_text_message_length:
    //   [bytes]  = maximum number of bytes that the total (unfragmented)
    //              length of an incoming WebSocket text message is allowed
    //              to contain (used by the default implementations of
    //              `WS_Server_Session::do_on_ws_text_stream()` and
    //              `WS_Client_Session::do_on_ws_text_stream()`)
    //   null     = default value: 1 MiB
    max_websocket_text_message_length: 1048576

    // max_websocket_binary_message_length:
    //   [bytes]  = maximum number of bytes that the total (unfragmented)
    //              length of an incoming WebSocket binary message is
    //              allowed to contain (used by the default implementations
    //              of `WS_Server_Session::do_on_ws_binary_stream()` and
    //              `WS_Client_Session::do_on_ws_binary_stream()`)
    //   null     = default value: 1 MiB
    max_websocket_binary_message_length: 1048576
  }
}

fiber: {
  // stack_vm_size:
  //   [bytes]  = stack size for each fiber, including 2 guard pages (must
  //              be a multiple of 65536)
  //   null     = use system thread stack size
  stack_vm_size: null

  // warn_timeout:
  //   [secs]   = print a warning if suspension exceeds this duration
  //   null     = default value: 15 seconds
  warn_timeout: 15

  // fail_timeout
  //   [secs]   = resume execution if suspension exceeds this duration
  //   null     = default value: 300 seconds
  fail_timeout: 300
}

addons: [
  // This is the list of addons (shared libraries) to load. Addons are
  // loaded in this precise order. If a string is not a path, but a file
  // name, conventional library search rules apply. Addons cannot be
  // unloaded.
//  "poseidon-example_timer.so"
//  "poseidon-example_udp_echo_server.so"
//  "poseidon-example_tcp_echo_server.so"
//  "poseidon-example_ssl_echo_server.so"
//  "poseidon-example_http_server.so"
//  "poseidon-example_http_client.so"
//  "poseidon-example_https_server.so"
//  "poseidon-example_https_client.so"
  "poseidon-example_ws_server.so"
  "poseidon-example_ws_client.so"
//  "poseidon-example_wss_server.so"
//  "poseidon-example_wss_client.so"
]
